CREATE DATABASE qanda CHARACTER SET utf8;

--- 記事
CREATE TABLE `article_posts` (
  `article_id` int(11) NOT NULL AUTO_INCREMENT,
  `user_id` int(11) NOT NULL,
  `title` text NOT NULL,
  `message` text NOT NULL,
  `post_date` datetime NOT NULL DEFAULT current_timestamp(),
  `upd_date` datetime DEFAULT NULL,
  `cate_id` int(11) NOT NULL,
  `article_image` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`article_id`),
  KEY `article_posts_ix1` (`upd_date`),
  KEY `article_posts_ix2` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `article_likes` (
  `a_like_id` int(11) NOT NULL AUTO_INCREMENT,
  `user_id` int(11) NOT NULL,
  `article_id` int(11) NOT NULL,
  `like_flg` int(11) NOT NULL DEFAULT 0,
  PRIMARY KEY (`a_like_id`),
  KEY `article_likes_ix1` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- todo
CREATE TABLE `todo` (
  `todo_id` int(11) NOT NULL AUTO_INCREMENT,
  `user_id` int(11) NOT NULL,
  `title` text NOT NULL,
  `state` varchar(8) NOT NULL,
  `remind_date` datetime NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`todo_id`),
  KEY `todo_ix1` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;


-- カテゴリ
CREATE TABLE `categories` (
  `cate_id` int(11) NOT NULL AUTO_INCREMENT,
  `category_name` varchar(255) NOT NULL,
  PRIMARY KEY (`cate_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

insert into categories values
(1, '数学'),
(2, '英語'),
(3, '国語');


-- ユーザー
CREATE TABLE `users` (
  `user_id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(255) NOT NULL,
  `tel` varchar(255) NULL,
  `password` varchar(100) NOT NULL,
  `email` varchar(255) NOT NULL,
  `icon` varchar(255) DEFAULT NULL,
  `tw_user` varchar(255) DEFAULT NULL,
  `q_disp_flg` int(11) NOT NULL DEFAULT 0,
  `level` int(11) NOT NULL DEFAULT 0,
  `exp` int(11) NOT NULL DEFAULT 0,
  `comment` text DEFAULT NULL,
  `pre_level` int(11) DEFAULT NULL,
  `pre_exp` int(11) DEFAULT NULL,
  PRIMARY KEY (`user_id`),
  KEY `users_ix1` (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

--外部キー
ALTER TABLE `article_likes`
  ADD FOREIGN KEY(`user_id`) REFERENCES `users`(`user_id`),
  ADD FOREIGN KEY(`article_id`) REFERENCES `article_posts`(`article_id`);

ALTER TABLE `article_posts`
  ADD FOREIGN KEY(`user_id`) REFERENCES `users`(`user_id`),
  ADD FOREIGN KEY(`cate_id`) REFERENCES `categories`(`cate_id`);

ALTER TABLE `todo`
  ADD FOREIGN KEY(`user_id`) REFERENCES `users`(`user_id`);
